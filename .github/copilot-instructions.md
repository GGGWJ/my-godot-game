# Godot 系统设计准则 (Design Principles)

本指南概括了本项目遵循的核心架构思想。在进行代码生成、重构建议或系统设计时，应以此为最高准则。

## 1. 结构哲学：组合优于继承 (Composition vs Inheritance)
*   **功能原子化**: 优先将功能拆分为职责单一的“组件节点”，通过节点的组合来构建复杂对象，而非建立深层的类继承树。
*   **单一职责**: 每个脚本或系统应只关注一个核心任务。避免创建“上帝类 (God Objects)”。

## 2. 通信规范：单向流动与解耦 (Communication & Decoupling)
*   **指令下达，信号回传**: 父节点通过方法调用控制其直接子节点；子节点通过信号向上传递状态变化。严禁底层节点直接引用或修改高层节点数据。
*   **表现中介架构**: 彻底解耦业务逻辑与表现形式。逻辑层负责状态流转并发出信号，表现层作为消费者决定展示逻辑。
*   **中性解耦**: 跨系统、跨模块的非父子通信必须通过全局事件总线或中介者进行，消除系统间的直接强依赖。

## 3. 状态管理：显式化与防腐 (State & Encapsulation)
*   **内部状态保护**: 对象的内部数据应受到保护。外部仅能通过受控的 API 请求修改，禁止跨层级直接操作成员变量。
*   **逻辑朝向分离**: 维护独立的逻辑意图朝向。视觉层应综合判断物理运动与逻辑意图，而非单一依赖物理分量。
*   **数据驱动逻辑**: 系统的行为参数应尽可能由外部配置资源驱动，实现业务逻辑与数值配置的彻底分离。

## 4. 类型安全与 API 规范
*   **全显式类型声明**: 所有变量、参数及函数返回值必须标注静态类型。
*   **接口化访问**: 禁止直接跨层级查找并操作实体内部的私有节点。所有对内部功能的访问必须通过预定义的标准化公共接口进行。
*   **资源实例隔离**: 在涉及多实例共享资源的表现层初始化时，必须执行物理复制以确保各实例间的视觉状态互不干扰。

## 5. 性能哲学：按需触发 (Event-Driven vs Polling)
*   **事件驱动优先**: 优先使用信号和事件触发逻辑，避免在 `_process` 等高频循环中执行非必要的持续检测。
*   **开销防御**: 对于高损耗的计算逻辑（寻路、探测等），必须建立频率限制或按需更新机制，确保帧率平稳。

## 6. 视图与逻辑分离 (View-Logic Separation)
*   **显示不感知逻辑**: 表现层（UI、动画、特效）应作为逻辑状态的“消费者”。逻辑层不应关心表现层具体的节点结构或实现细节。

## 7. 资源与内存意识 (Resource Awareness)
*   **引用安全**: 对动态生成的对象及计时器应有明确的生命周期管理，防止孤立节点导致的内存泄漏。
